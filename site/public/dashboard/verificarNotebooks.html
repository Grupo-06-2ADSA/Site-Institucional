<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Máquinas</title>
    <script src="../js/sessao.js"></script>
    <link rel="shortcut icon" href="img/circle-MindCore-azul.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style-responsivo.css">
    <link rel="stylesheet" href="modal.css">
</head>

<body onload="validarSessao(), visualizarMaquinas()">
    <div class="left-sidebar">
        <img class="imgLogo" src="img/logo-MindCore.png" alt="logo">

        <div class="menu">
            <div class="bloco 1">
                <a onclick="verificarTipo()">
                    <img class="imgBloco" src="img/bar-chart.png">
                    <p>Dashboard</p>
                </a>
            </div>

            <div class="bloco 2 aqui">
                <a href="verificarNotebooks.html">
                    <img class="imgBloco" src="img/computador.png">
                    <p>Parque de Máquinas</p>
                </a>
            </div>

            <div class="bloco 3 ">
                <a href="users.html">
                    <img class="imgBloco" src="img/adicionar-usuario.png">
                    <p>Adicionar Usuário</p>
                </a>
            </div>

            <div class="bloco 4">
                <a href="estoque.html">
                    <img class="imgBloco" src="img/estoque.png">
                    <p>Estoque</p>
                </a>
            </div>
        </div>

        <div class="logout" onclick="limparSessao()">
            <img src="img/sair.png">
        </div>
    </div>
    <div class="dados">
        <div class="perfil">
            <div class="turmas">
                <p>Turmas</p>
                <select name="turmas" id="turma" onchange="visualizarMaquinas()">
                    <option value=1>ADS A</option>
                    <option value=2>ADS B</option>
                    <option value=3>ADS C</option>
                    <option value=4>SIS</option>
                    <option value=5>CCO</option>
                    <option value=6>Reserva</option>
                </select>
            </div>

            <div class="usuario">
                <div class="texto">
                    <p class="nome" id="nomeUsuario">Olá, </p>
                    <p id="tipoUsuario">Técnico</p>
                </div>
                <img src="img/usuario.png">
            </div>
        </div>

        <div id="notebooks">
            <div class="pesquisar">
                <p>HostName:</p>
                <input id="Pesquisar">
                <button onclick="pesquisarNote()">Pesquisar</button>
            </div>
            <div class="header-tabela">
                <p class="id-campo">HostName</p>
                <p id="status_campo">Status</p>
                <p id="ult_mod">Última Imagem</p>
                <p class="editar-campo"></p>
                <p class="excluir-campo"></p>
            </div>
            <div id="repeticao">

            </div>
            <button onclick="AdicionarMaquina()" class="adicionar">Adicionar</button>

            <div id="myModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <span class="close">&times;</span>
                        <div id="header">
                            <h2 id="header-title"></h2>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="dashs">
                            <div class="cpu">
                                <span class="bolinhaCPU" style="width: 20px; height: 20px; background-color: green;border-radius: 100px; margin-left: 28%; position: absolute;"></span>
                                <h3 id="nomeCPU">CPU:</h3>
                                <!-- Gráfico -->
                                <canvas id="myChartCPU"
                                    style="display: block; box-sizing: border-box; height: 100px; width: 200px;"></canvas>
                                <div class="infos">
                                    <div class="info">
                                        <h5>Tempo de Atividade</h5>
                                        <span id="tempoAtividade"></span>
                                    </div>
                                    <div class="info">
                                        <h5>Uso CPU%</h5>
                                        <span id="usoCPU"></span>
                                    </div>
                                    <div class="info">
                                        <h5>Temperatura</h5>
                                        <span>55ºC</span>
                                    </div>
                                </div>
                            </div>

                            <div class="ram">
                                <span class="bolinhaRAM" style="width: 20px; height: 20px; background-color: green;border-radius: 100px; margin-left: 45%; position: absolute;"></span>
                                <h3 id="tamanhoRAM">Memória Ram:</h3>
                                <div class="chart">
                                    <canvas id="myChartRAM"
                                        style="display: block; box-sizing: border-box; height: 100px; width: 150px;"></canvas>
                                    <canvas id="myChartRAM2"
                                        style="display: block; box-sizing: border-box; height: 30px; width: 30px;"></canvas>
                                </div>
                            </div>

                        </div>

                        <div class="dashs">
                            <div class="rede">
                                <h3>Histórico de Manutenções <button onclick="adicionarHistorico()">Adicionar</button>
                                </h3>
                                <div class="headerManutencao">
                                    <p class="header-descricao">Descrição</p>
                                    <p class="header-responsavel">Responsável</p>
                                    <p class="header-tipo">Tipo</p>
                                    <p class="header-data">Data</p>
                                </div>
                                <div class="bodyManutencao" id="manutencoes">

                                </div>
                            </div>

                            <div class="disco">
                                <span class="bolinhaDisco" style="width: 20px; height: 20px; background-color: green;border-radius: 100px; margin-left: 20%; position: absolute;"></span>
                                <h3 id="tamanhoDisco">Disco:</h3>
                                <canvas id="myChartDISCO"
                                    style="display: block; box-sizing: border-box; height: 8%; width: 10%;"></canvas>

                            </div>
                        </div>

                    </div>

                </div>
                <div id="modalHistorico" class="modalUsuario">
                    <div class="modal-conteudo">
                        <div class="modal-header">
                            <span class="close4">&times;</span>
                            <div id="header">
                                <h2 id="header-title-historico"></h2>
                            </div>
                        </div>
                        <div class="modal-body-usuario">
                            <div class="formulario">
                                <div class="campo">
                                    <span>Descrição</span>
                                    <input type="text" id="descricao">
                                </div>

                                <div class="campo">
                                    <span>Tipo</span>
                                    <select name="" id="tipo">
                                        <option value="Limpeza">Limpeza</option>
                                        <option value="Memoria">Memória</option>
                                        <option value="Rede">Rede</option>
                                        <option value="Disco">Disco</option>
                                        <option value="CPU">CPU</option>
                                        <option value="Bateria">Bateria</option>
                                    </select>
                                </div>
                                <div class="campo">
                                    <span>Data</span>
                                    <input type="date" id="dtmanutencao">
                                </div>
                                <div class="alerta_erro">
                                    <div class="card_erro" id="cardErro">
                                        <span id="mensagem_erro_historico"></span>
                                    </div>
                                </div>
                                <div class="botoes">
                                    <button class="cancelar" onclick="cancelarHistorico()">Cancelar</button>
                                    <button class="adicionar-botao" onclick="cadastrarHistorico()">Adicionar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="modalAdicionar" class="modalUsuario">
                <div class="modal-conteudo">
                    <div class="modal-header-usuario">
                        <span class="close2">&times;</span>
                        <div id="header">
                            <h2 id="header-title-usuario"></h2>
                        </div>
                    </div>
                    <div class="modal-body-usuario">
                        <div class="formulario">
                            <div class="campo">
                                <span>HostName</span>
                                <input type="text" id="hostnameCadastro">
                            </div>
                            <div class="campo">
                                <span>IPV4</span>
                                <input type="text" id="ipv4" oninput="mascaraIP(this)" maxlength="15"
                                    placeholder="000.000.000.000">
                            </div>
                            <div class="campo">
                                <span>Sala</span>
                                <select name="salas" id="salaCadastro">
                                    <option value=1>ADS A</option>
                                    <option value=2>ADS B</option>
                                    <option value=3>ADS C</option>
                                    <option value=4>SIS</option>
                                    <option value=5>CCO</option>
                                    <option value=6>Reserva</option>
                                </select>
                            </div>
                            <div class="campo">
                                <span>Última Imagem</span>
                                <input type="date" id="dtImagem">
                            </div>
                            <div class="alerta_erro">
                                <div class="card_erro" id="cardErro">
                                    <span id="mensagem_erro"></span>
                                </div>
                            </div>
                            <div id="div_aguardar" class="loading-div">
                                <img src="../assets/img/login-cadastro/aguarde-orange.gif" id="loading-gif" />
                            </div>
                            <div class="botoes">
                                <button class="cancelar" onclick="cancelarAdicao()">Cancelar</button>
                                <button class="adicionar-botao" onclick="cadastrarMaquina()">Adicionar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="modalEditar" class="modalUsuario">
                <div class="modal-conteudo">
                    <div class="modal-header">
                        <span class="close3">&times;</span>
                        <div id="header">
                            <h2 id="header-title-maquina"></h2>
                        </div>
                    </div>
                    <div class="modal-body-usuario">
                        <div class="formulario">
                            <div class="campo">
                                <span>HostName</span>
                                <input type="text" id="hostnameInput">
                            </div>
                            <div class="campo">
                                <span>IPV4</span>
                                <input type="text" id="ipv4Input" oninput="mascaraIP(this)" maxlength="15"
                                    placeholder="000.000.000.000">
                            </div>
                            <div class="campo">
                                <span>Sala</span>
                                <select name="turmas" id="turmaAlteracao">
                                    <option value=1>ADS A</option>
                                    <option value=2>ADS B</option>
                                    <option value=3>ADS C</option>
                                    <option value=4>SIS</option>
                                    <option value=5>CCO</option>
                                    <option value=6 selected>Reserva</option>
                                </select>
                            </div>
                            <div class="campo">
                                <span>Última Imagem</span>
                                <input type="date" id="dtImagemInput">
                            </div>
                            <div class="alerta_erro">
                                <div class="card_erro" id="cardErro">
                                    <span id="mensagem_erro_editar"></span>
                                </div>
                            </div>
                            <div class="botoes">
                                <button class="cancelar" onclick="cancelarAlteracao()">Cancelar</button>
                                <button class="adicionar-botao" onclick="salvarAlteracoes()">Salvar Alterações</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>


    function visualizarMaquinas() {
        repeticao.innerHTML = '';

        fetch("/maquinas/buscarMaquinas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkEmpresaServer: sessionStorage.EMPRESA_USUARIO,
                fkSalaServer: turma.value
            }),
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO buscar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    for (i = 0; i < json.length; i++) {
                        let dataString = json[i].imagem;
                        let data = new Date(dataString);


                        repeticao.innerHTML += `
                        <div id="campo"">
                            <p class="hostname" onclick="graficos('${json[i].hostname}', event)">${json[i].hostname}</p>
                            <div class="bolinha" id="bolinha${i}"></div>
                            <p class="ultimaModificacao">${data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}</p>
                            <p id="editar" data-hostname="${json[i].hostname}" data-ip="${json[i].ip}" data-dtImagem="${data.getFullYear()}-${String(data.getMonth() + 1).padStart(2, '0')}-${String(data.getDate()).padStart(2, '0')}" onclick="editarMaquina(event)">Editar</p>
                            <img src="../assets/img/excluir.png" onclick="excluirMaquina('${json[i].hostname}')">
                        </div>`;


                        const elemento = document.getElementById('bolinha' + i);

                        // if (json[i].status == 2) {
                        // elemento.setAttribute("style", "background-color: red;");
                        // } else if (json[i].status == 1) {
                        //     elemento.setAttribute("style", "background-color: yellow;")
                        // }

                        if (i >= 6) {
                            repeticao.style.overflowY = "scroll";
                            notebooks.style.overflow = "hidden";
                        }
                    }

                    

                });

            } else {
                console.log("Houve um erro ao tentar realizar o select da busca!");
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;

    }

    let hostnameVar;

    let modalEdicao = document.getElementById("modalEditar");
    function editarMaquina(event) {
        let tituloHeader = document.getElementById("header-title-maquina");
        let elemento = event.target;

        hostname = elemento.dataset.hostname;
        let ip = elemento.dataset.ip;
        let dtImagem = elemento.dataset.dtImagem;

        console.log("Hostname:", hostname);
        console.log("IP:", ip);
        console.log("Data da Imagem:", dtImagem);

        modalEdicao.style.display = "block";
        tituloHeader.innerHTML = `Editar Máquina`;

        let hostNameInput = document.getElementById("hostnameInput");
        let ipInput = document.getElementById("ipv4Input");
        let imagemInput = document.getElementById("dtImagemInput");


        hostNameInput.value = hostname;
        ipInput.value = ip;
        imagemInput.value = dtImagem;
    }

    function excluirMaquina(hostname) {
        excluirHistorico(hostname);
        let confirmar = confirm("Você tem certeza que deseja excluir o computador?");
        if (!confirmar) {
            return;
        }

        fetch("/maquinas/excluirMaquina", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                hostnameServer: hostname
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    alert("Computador excluído com sucesso!")

                    location.reload();

                } else {
                    throw "Houve um erro ao tentar realizar o delete!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }

    function excluirHistorico(hostname) {
        fetch("/maquinas/excluirHistorico", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                hostnameServer: hostname
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log("Historico excluido com sucesso")

                } else {
                    throw "Houve um erro ao tentar realizar o delete!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }


    let modal = document.getElementById("myModal");
    let modalAdicionar = document.getElementById("modalAdicionar");
    let span = document.getElementsByClassName("close")[0];
    let span2 = document.getElementsByClassName("close2")[0];
    let span3 = document.getElementsByClassName("close3")[0];

    let hostnameGrafico;
    function graficos(hostname, event) {
        let tituloHeader = document.getElementById("header-title");
        let elemento = event.target;
        hostnameVar = hostname;

        //hostname = elemento.dataset.hostname;
        tituloHeader.innerHTML = "";
        modal.style.display = "block";
        tituloHeader.innerHTML += `HostName: ${hostname}`;
        hostnameGrafico = '';
        hostnameGrafico = hostname
        listarManutencao(hostname);
        // for (let i = 0; i < obj.length; i++) {
        //     if (hostname == obj[i].hostname) {
        //         let statusComputador = obj[i].estado == 1 ? "red" : "green";

        //         tituloHeader.innerHTML += `<button class="alerta ${statusComputador}" id="alerta${i}"></button>`;
        //     }
        // }
        
        //location.reload();
        limparGrafico();
        plotarGraficoMaq()
        setInterval(() => {
            plotarGraficoMaq();
        }, 10000);


    }
    
    function listarManutencao(hostname) { 
        let manutencao = document.getElementById("manutencoes");
        manutencao.innerHTML = "";

        fetch("/maquinas/buscarManutencoes", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                hostnameServer: hostname
            }),
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO buscar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    
                    
                    for (let i = 0; i < json.length; i++) {
                        let dataString = json[i].Dia;
                        let data = new Date(dataString);

                        manutencao.innerHTML += `
                        <div class="informacoes">
                            <p class="campo-descricao">${json[i].descricao}</p>
                            <p class="campo-responsavel">${json[i].nomeResponsavel}</p>
                            <p class="campo-tipo">${json[i].tipo}</p>
                            <p class="campo-data">${data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}</p>
                        </div>`;

                        if (i >= 7) {
                            manutencao.style.overflowY = "scroll";
                        }
                    }

                });

            } else {
                console.log("Houve um erro ao tentar realizar o select!");
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;


    }

    let modalManutencao = document.getElementById("modalHistorico");
    let tituloHistorico = document.getElementById("header-title-historico");
    let span4 = document.getElementsByClassName("close4")[0];

    function adicionarHistorico() {
        modalManutencao.style.display = "block"
        tituloHistorico.innerHTML = "Adicionar manutenção"
    }

    function cancelarHistorico() {
        modalManutencao.style.display = "none"
    }

    function cadastrarHistorico() {
        let descricaoInput = descricao.value;
        let tipoInput = tipo.value;
        let dataManutencao = dtmanutencao.value;
        console.log("HOSTNAMEVAR:"+hostnameVar);

        fetch("/maquinas/cadastrarManutencao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                descricaoServer: descricaoInput,
                tipoServer: tipoInput,
                dataServer: dataManutencao,
                hostnameServer: hostnameVar,
                responsavelServer: sessionStorage.ID_USUARIO
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    let cardErro = document.getElementById("cardErro");
                    let mensagemErroEditar = document.getElementById("mensagem_erro_historico");

                    if (cardErro && mensagemErroEditar) {
                        cardErro.style.display = "block";
                        mensagemErroEditar.innerHTML = "Cadastro realizado com sucesso!";
                        hostnameVar = undefined;

                        setTimeout(() => {
                            mensagemErroEditar.innerHTML = "";
                            cardErro.style.display = "none";
                            location.reload();
                        }, 2000);

                    } else {
                        console.error("Elementos de mensagem de erro não encontrados.");
                    }

                } else {
                    resposta.text().then(texto => {
                        console.error("Erro no servidor:", texto);
                        alert(`Erro ao cadastrar: ${texto}`);
                    });
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    span.onclick = function () {
        modal.style.display = "none";
    }

    span2.onclick = function () {
        modalAdicionar.style.display = "none";
    }

    span3.onclick = function () {
        modalEdicao.style.display = "none";
    }


    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function mascaraIP(input) {
        let value = input.value;
        // Remove todos os caracteres que não são números ou pontos
        value = value.replace(/[^\d.]/g, '');

        // Divide em blocos por ponto
        let blocks = value.split('.').map(block => block.slice(0, 3));

        blocks = blocks.slice(0, 4);

        // Recria o valor com os blocos formatados
        input.value = blocks.join('.');

        // Verifica e ajusta a validade dos números entre 0 e 255
        for (let i = 0; i < blocks.length; i++) {
            if (blocks[i] !== '' && (parseInt(blocks[i]) < 0 || parseInt(blocks[i]) > 255)) {
                blocks[i] = '255';
            }
        }

        // Atualiza o valor de entrada com os blocos válidos
        input.value = blocks.join('.').slice(0, 15)
    }

    let statusCampo = document.getElementById("status_campo");
    let modificacao = document.getElementById("ult_mod");

    statusCampo.onclick = function () {
        img_ordenar.innerHTML = "img/ordenar-decrescente.png";
    }


    function AdicionarMaquina() {
        let tituloHeader = document.getElementById("header-title-usuario");

        modalAdicionar.style.display = "block";
        tituloHeader.innerHTML = `Adicionar nova máquina`;
    }


    let fkSala;

    function cadastrarMaquina() {
        let hostName = hostnameCadastro.value;
        let ip = ipv4.value;
        let dataImagem = dtImagem.value;
        let sala = salaCadastro.value;


        fetch("/maquinas/cadastrarMaquina", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                hostNameServer: hostName,
                ipv4Server: ip,
                imagemServer: dataImagem,
                fkSalaServer: sala,
                fkEmpresaServer: sessionStorage.EMPRESA_USUARIO
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    let cardErro = document.getElementById("cardErro");
                    let mensagemErroEditar = document.getElementById("mensagem_erro_editar");

                    if (cardErro && mensagemErroEditar) {
                        cardErro.style.display = "block";
                        mensagemErroEditar.innerHTML = "Alteração realizada com sucesso!";

                        setTimeout(() => {
                            mensagemErroEditar.innerHTML = "";
                            cardErro.style.display = "none";
                            location.reload();
                        }, 2000);

                    } else {
                        console.error("Elementos de mensagem de erro não encontrados.");
                    }
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    function salvarAlteracoes() {
        let confirmar = confirm("Você tem certeza que deseja salvar as alterações?");
        if (!confirmar) {
            return;
        }

        let hostname = document.getElementById("hostnameInput").value;
        let ip = document.getElementById("ipv4Input").value;
        let dtImagem = document.getElementById("dtImagemInput").value;
        let sala = document.getElementById("turmaAlteracao").value;

        fetch("/maquinas/atualizarMaquina", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                hostnameServer: hostname,
                ipv4Server: ip,
                imagemServer: dtImagem,
                salaServer: sala,
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    let cardErro = document.getElementById("cardErro");
                    let mensagemErroEditar = document.getElementById("mensagem_erro_editar");

                    if (cardErro && mensagemErroEditar) {
                        cardErro.style.display = "block";
                        mensagemErroEditar.innerHTML = "Alteração realizada com sucesso!";

                        setTimeout(() => {
                            mensagemErroEditar.innerHTML = "";
                            cardErro.style.display = "none";
                            location.reload();
                        }, 2000);

                        limparFormulario();
                    } else {
                        console.error("Elementos de mensagem de erro não encontrados.");
                    }

                    limparFormulario();
                } else {
                    throw "Houve um erro ao tentar realizar o update!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }

    function cancelarAlteracao() {
        modalEdicao.style.display = "none";
    }

    function cancelarAdicao() {
        modalAdicionar.style.display = "none";
    }
    window.onclick = function (event) {
        if (event.target == modalAdicionar) {
            modalAdicionar.style.display = "none";
        }
    }
</script>

<script>
    let listaLeituraCPU = [];
    function leituraCPU() { 
        fetch("/dashboard/leituraCPU", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkMaquinaServer: hostnameGrafico
            }),
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO buscar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    
                    usoCPU.innerHTML = (json[0].emUso).toFixed(2) + '%';
                    nomeCPU.innerHTML = `CPU: ${json[0].nome}`;
                    if(json[0].tempoAtividade ==  1){
                        tempoAtividade.innerHTML = `${json[0].tempoAtividade} dia`
                    }
                    else if(json[0].tempoAtividade >  1){
                        tempoAtividade.innerHTML = `${json[0].tempoAtividade} dias`
                    }
                    else{
                        tempoAtividade.innerHTML = `Menos de 1 dia`
                    }

                    if(json[0].tempoAtividade >= 7 || json[0].emUso == 100){
                        document.getElementsByClassName("bolinhaCPU")[0].style.backgroundColor = 'red';
                    }else if(json[0].tempoAtividade >= 7 || json[0].emUso >= 80){
                        document.getElementsByClassName("bolinhaCPU")[0].style.backgroundColor = 'yellow';
                    }
                    else{
                        document.getElementsByClassName("bolinhaCPU")[0].style.backgroundColor = 'green';
                    }

                        listaLeituraCPU.push(json[0].emUso)
                        listaLeituraCPU.shift();

                        myChartCPU.data.datasets[0].data = listaLeituraCPU;
                        myChartCPU.update();
                    
                    

                    

                });

            } else {
                console.log("Houve um erro ao tentar realizar o select!");
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;


    }
    let listaLeituraRAM = [];
    function leituraRAM() { 
        fetch("/dashboard/leituraRAM", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkMaquinaServer: hostnameGrafico
            }),
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO buscar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    if((json[0].emUso / json[0].total) * 100 > 90){
                        document.getElementsByClassName("bolinhaRAM")[0].style.backgroundColor = 'red';
                    }else if((json[0].emUso / json[0].total) * 100 >= 80){
                        document.getElementsByClassName("bolinhaRAM")[0].style.backgroundColor = 'yellow';
                    }
                    else{
                        document.getElementsByClassName("bolinhaRAM")[0].style.backgroundColor = 'green';
                    }
                    
                    tamanhoRAM.innerHTML = `Memória RAM: ${json[0].total}GB`
                    
                    listaLeituraRAM.push((json[0].emUso / json[0].total) * 100)
                        listaLeituraRAM.shift();

                        myChartRAM.data.datasets[0].data = listaLeituraRAM;
                        myChartRAM.update();

                        myChartRAM2.data.datasets[0].data = [json[0].emUso, (json[0].total - json[0].emUso)];
                        myChartRAM2.update();

                });

            } else {
                console.log("Houve um erro ao tentar realizar o select!");
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;


    }

    function leituraDisco() { 
        fetch("/dashboard/leituraDisco", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkMaquinaServer: hostnameGrafico
            }),
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO buscar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    if((json[0].emUso / json[0].total) * 100 > 90){
                        document.getElementsByClassName("bolinhaDisco")[0].style.backgroundColor = 'red';
                    }else if((json[0].emUso / json[0].total) * 100 >= 80){
                        document.getElementsByClassName("bolinhaDisco")[0].style.backgroundColor = 'yellow';
                    }
                    else{
                        document.getElementsByClassName("bolinhaDisco")[0].style.backgroundColor = 'green';
                    }
                
                    
                    tamanhoDisco.innerHTML = `Disco: ${json[0].total}GB`
                    
                        myChartDISCO.data.datasets[0].data = [json[0].emUso, json[0].disponivel];
                        myChartDISCO.update();
                });

            } else {
                console.log("Houve um erro ao tentar realizar o select!");
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;


    }


    function plotarGraficoMaq(){
        leituraCPU();
        leituraRAM();
        leituraDisco();
          
    }

    function limparGrafico(){
        listaLeituraCPU = [0,0,0,0,0,0,0];
        myChartCPU.data.datasets[0].data = listaLeituraCPU;
        myChartCPU.update();
        nomeCPU.innerHTML = 'CPU:';
        usoCPU.innerHTML = '';
        tempoAtividade.innerHTML = '';

        
        listaLeituraRAM = [0,0,0,0,0,0,0];
        myChartRAM.data.datasets[0].data = listaLeituraRAM;
        myChartRAM.update();
        tamanhoRAM.innerHTML = 'Memória Ram:';

        myChartRAM2.data.datasets[0].data = [];
        myChartRAM2.update();

        myChartDISCO.data.datasets[0].data = [];
        myChartDISCO.update();
        tamanhoDisco.innerHTML = 'Disco:'

        
    }

    //CHART CPU------------------------------------------------------
    const labelsCPU = ['60s', '50s', '40s', '30s', '20s', '10s', '0s'];
    const dataCPU = {
        labels: labelsCPU,
        datasets: [{
            label: 'Uso CPU %',
            data: listaLeituraCPU,
            fill: false,
            borderColor: '#9340FF',
            tension: 0.1
        }]
    };
    const configCPU = {
        type: 'line',
        data: dataCPU,
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 100
                }
            }
        }
    };

    const myChartCPU = new Chart(
        document.getElementById('myChartCPU'),
        configCPU
    );

    // CHART RAM-----------------------------------------------------

    const labelsRAM = ['60s', '50s', '40s', '30s', '20s', '10s', '0s'];
    const dataRAM = {
        labels: labelsRAM,
        datasets: [{
            label: 'Uso RAM %',
            data: listaLeituraRAM,
            fill: false,
            borderColor: '#9340FF',
            tension: 0.1
        }]
    };
    const configRAM = {
        type: 'line',
        data: dataRAM,
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 100
                }
            }
        }
    };

    const myChartRAM = new Chart(
        document.getElementById('myChartRAM'),
        configRAM
    );

    const dataRAM2 = {
        labels: [
            'Em uso',
            'Disponível'
        ],
        datasets: [{
            label: 'GB',
            data: [3466, 4534],
            backgroundColor: [
                '#9340FF',
                '#023971'
            ],
            hoverOffset: 4
        }]
    };
    const configRAM2 = {
        type: 'pie',
        data: dataRAM2,
    };

    const myChartRAM2 = new Chart(
        document.getElementById('myChartRAM2'),
        configRAM2
    );
    // DISCO-------------------------------------------------------
    const dataDISCO = {
        labels: [
            'Em uso',
            'Disponível'
        ],
        datasets: [{
            label: 'GB',
            data: [320, 180],
            backgroundColor: [
                '#9340FF',
                '#023971'
            ],
            hoverOffset: 4
        }]
    };
    const configDISCO = {
        type: 'pie',
        data: dataDISCO,
    };

    const myChartDISCO = new Chart(
        document.getElementById('myChartDISCO'),
        configDISCO
    );
 
</script>